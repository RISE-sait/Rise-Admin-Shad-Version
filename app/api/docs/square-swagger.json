{
  "openapi": "3.0.2",
  "info": {
    "title": "Rise Square Payment Service",
    "description": "Square payment processing and subscription management",
    "version": "1.0.0"
  },
  "paths": {
    "/subscriptions/checkout": {
      "post": {
        "summary": "Create Subscription Checkout",
        "description": "Create a Square Checkout link for subscription signup.",
        "operationId": "create_subscription_checkout_subscriptions_checkout_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubscriptionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SubscriptionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/subscriptions/{subscription_id}/manage": {
      "post": {
        "summary": "Manage Subscription",
        "description": "Manage subscription (pause, resume, cancel, etc.).",
        "operationId": "manage_subscription_subscriptions__subscription_id__manage_post",
        "parameters": [
          {
            "required": true,
            "schema": {
              "title": "Subscription Id",
              "type": "string"
            },
            "name": "subscription_id",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubscriptionManagementRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SubscriptionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/subscriptions/{subscription_id}/sync-billing": {
      "post": {
        "summary": "Manual Sync Billing Date",
        "description": "Manually trigger billing date sync for a subscription.",
        "operationId": "manual_sync_billing_date_subscriptions__subscription_id__sync_billing_post",
        "parameters": [
          {
            "required": true,
            "schema": {
              "title": "Subscription Id",
              "type": "string"
            },
            "name": "subscription_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Manual Sync Billing Date Subscriptions  Subscription Id  Sync Billing Post",
                  "type": "object"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/subscriptions/{subscription_id}": {
      "get": {
        "summary": "Get Subscription Details",
        "description": "Get subscription details from Square API.",
        "operationId": "get_subscription_details_subscriptions__subscription_id__get",
        "parameters": [
          {
            "required": true,
            "schema": {
              "title": "Subscription Id",
              "type": "string"
            },
            "name": "subscription_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Get Subscription Details Subscriptions  Subscription Id  Get",
                  "type": "object"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/checkout/event": {
      "post": {
        "summary": "Checkout Event",
        "description": "Create checkout for event enrollment.",
        "operationId": "checkout_event_checkout_event_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EventCheckoutRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Response Checkout Event Checkout Event Post",
                  "type": "object"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/webhook": {
      "post": {
        "summary": "Handle Webhook",
        "description": "Handle Square webhooks.",
        "operationId": "handle_webhook_webhook_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/admin/square/subscription-plans": {
      "get": {
        "summary": "List Square Subscription Plans",
        "description": "List available Square subscription plans.",
        "operationId": "list_square_subscription_plans_admin_square_subscription_plans_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/admin/memberships/expire": {
      "post": {
        "summary": "Expire Memberships",
        "description": "Expire memberships that have passed their renewal date.",
        "operationId": "expire_memberships_admin_memberships_expire_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/admin/sync/status": {
      "get": {
        "summary": "Get Sync Status",
        "description": "Get comprehensive sync status and health metrics.",
        "operationId": "get_sync_status_admin_sync_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/admin/sync/force": {
      "post": {
        "summary": "Force Full Sync",
        "description": "Manually trigger a full synchronization.",
        "operationId": "force_full_sync_admin_sync_force_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/admin/webhooks/retry": {
      "post": {
        "summary": "Retry Failed Webhooks",
        "description": "Manually retry processing of failed webhook events.",
        "operationId": "retry_failed_webhooks_admin_webhooks_retry_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/admin/rate-limiter/status": {
      "get": {
        "summary": "Get Rate Limiter Status",
        "description": "Get rate limiter status for monitoring.",
        "operationId": "get_rate_limiter_status_admin_rate_limiter_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/debug/checkout/{checkout_id}": {
      "get": {
        "summary": "Debug Checkout Status",
        "description": "Debug checkout session status to see why payment failed.",
        "operationId": "debug_checkout_status_debug_checkout__checkout_id__get",
        "parameters": [
          {
            "required": true,
            "schema": {
              "title": "Checkout Id",
              "type": "string"
            },
            "name": "checkout_id",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "EventCheckoutRequest": {
        "title": "EventCheckoutRequest",
        "required": ["event_id"],
        "type": "object",
        "properties": {
          "event_id": {
            "title": "Event Id",
            "maxLength": 100,
            "minLength": 1,
            "type": "string",
            "description": "Valid event UUID"
          }
        }
      },
      "HTTPValidationError": {
        "title": "HTTPValidationError",
        "type": "object",
        "properties": {
          "detail": {
            "title": "Detail",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            }
          }
        }
      },
      "SubscriptionAction": {
        "title": "SubscriptionAction",
        "enum": ["pause", "resume", "cancel", "update_card"],
        "type": "string",
        "description": "An enumeration."
      },
      "SubscriptionManagementRequest": {
        "title": "SubscriptionManagementRequest",
        "required": ["action"],
        "type": "object",
        "properties": {
          "action": {
            "allOf": [
              {
                "$ref": "#/components/schemas/SubscriptionAction"
              }
            ],
            "description": "Action to perform on subscription"
          },
          "card_id": {
            "title": "Card Id",
            "type": "string",
            "description": "New card ID for update_card action"
          },
          "new_plan_variation_id": {
            "title": "New Plan Variation Id",
            "type": "string",
            "description": "For upgrade/downgrade actions"
          },
          "pause_cycle_duration": {
            "title": "Pause Cycle Duration",
            "type": "integer",
            "description": "Number of billing cycles to pause"
          },
          "cancel_reason": {
            "title": "Cancel Reason",
            "maxLength": 500,
            "type": "string",
            "description": "Reason for cancellation"
          }
        }
      },
      "SubscriptionRequest": {
        "title": "SubscriptionRequest",
        "required": ["membership_plan_id"],
        "type": "object",
        "properties": {
          "membership_plan_id": {
            "title": "Membership Plan Id",
            "type": "string",
            "description": "UUID of the membership plan"
          },
          "card_id": {
            "title": "Card Id",
            "type": "string",
            "description": "Card ID for automatic billing"
          },
          "start_date": {
            "title": "Start Date",
            "type": "string",
            "description": "ISO date string for subscription start"
          },
          "timezone": {
            "title": "Timezone",
            "type": "string",
            "description": "Timezone for the subscription",
            "default": "UTC"
          }
        }
      },
      "SubscriptionResponse": {
        "title": "SubscriptionResponse",
        "required": ["subscription_id", "status", "message"],
        "type": "object",
        "properties": {
          "subscription_id": {
            "title": "Subscription Id",
            "type": "string"
          },
          "status": {
            "title": "Status",
            "type": "string"
          },
          "message": {
            "title": "Message",
            "type": "string"
          },
          "subscription_url": {
            "title": "Subscription Url",
            "type": "string"
          },
          "checkout_url": {
            "title": "Checkout Url",
            "type": "string"
          }
        }
      },
      "ValidationError": {
        "title": "ValidationError",
        "required": ["loc", "msg", "type"],
        "type": "object",
        "properties": {
          "loc": {
            "title": "Location",
            "type": "array",
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            }
          },
          "msg": {
            "title": "Message",
            "type": "string"
          },
          "type": {
            "title": "Error Type",
            "type": "string"
          }
        }
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  }
}
